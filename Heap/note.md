# 堆

### 定义
- 堆（英语：Heap）是具有以下性质的完全二叉树，任意节点小于（或大于）它的左右子节点，最小值（或大值）在根元素位置。
- 我们称最小值在根节点（堆顶）的叫做小根（顶）堆，最大值在根节点（堆顶）的叫做大根（顶）堆。
- 任意节点小于（或大于）它的所有后裔，最小元（或最大元）在堆的根上（堆序性）。
- 堆总是一棵完全树。即除了最底层，其他层的节点都被元素填满，且最底层尽可能地从左到右填入。

### 二叉树的性质
我们假设一个数组的第一个元素（索引为 0）位于根节点，那么可以得出一下定义：
- 任意节点 i 的左节点索引是 ： 2 * i + 1
- 任意节点 i 的右节点索引是 ： 2 * i + 2
- 最后一个非叶子节点的索引是 ： floor (length / 2) - 1

### 实现上浮swim和下沉sink
**用大顶堆来举例**
1. 如果某个节点A比它的子节点（其中的一个）小，那就应该让下面大的那个节点来做父节点，这就是对A进行下沉。
2. 如果某个节点A比它的父节点大，那就应该让A来做父节点，这就是对A的上浮。
3. 同理小顶堆。（所以代码中肯定有一个while循环）

- 上浮的代码实现
```php
# k 节点 parent k的父节点
function swim($k,$parent){
    # 如果上浮到堆顶就不能上浮了
    while ($k > 1 && $parent < $k){
       list($parent,$k) = array($k,$parent); 
    }
}
```

- 下浮代码的实现
```php
function sink($k,$left,$right){
    $N = 1; # 堆底
    # 如果沉到堆底就沉不下去了
    while ($left <= $N){
        # 假设左右节点都存在
        $old = max($left,$right);
        if ($old < $k) break; # 如果左右节点中大的那一个比k小，k就不用动

        list($old,$k) = array($k,$old); # 否则k往下沉，较大的往上浮
    }
}
```


### 实现delMax和insert
- `insert` 方法先把要插入的元素添加到堆底的最后，然后让其上浮到正确的位置

- `delMax` 方法先将堆顶元素A和堆底最后的元素B对调，然后删除A，最后让B下沉到正确位置。